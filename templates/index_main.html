<!DOCTYPE html>
<html>
<head>
    <title>FastAPI Split View</title>
    <script src="https://cdn.jsdelivr.net/npm/ag-grid-community/dist/ag-grid-community.min.noStyle.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community/styles/ag-grid.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/ag-grid-community/styles/ag-theme-alpine.css">
    <style>
        body { margin: 0; display: flex; height: 100vh; font-family: sans-serif; }
        #sidebar { width: 250px; border-right: 1px solid #ccc; padding: 20px; background: #f9f9f9; overflow-y: auto; }
        #content { flex: 1; padding: 20px; display: flex; flex-direction: column; }
        .tree-node { cursor: pointer; padding: 5px; }
        .tree-node:hover { background: #e0e0e0; }
        .child-node { margin-left: 20px; font-size: 0.9em; color: #555; }
        #myGrid { flex: 1; width: 100%; height: 100%; }
        h3 { margin-top: 0; }
    </style>
</head>
<body>

    <div id="sidebar">
        <h3>ë¶€ì„œ ëª©ë¡</h3>
        <div id="tree-container"></div>
    </div>

    <div id="content">
        <h3 id="grid-title">í•­ëª©ì„ ì„ íƒí•˜ì„¸ìš”</h3>
        <div id="myGrid" class="ag-theme-alpine"></div>
    </div>

    <script>
        let gridApi;

    // 1. ì—¬ê¸°ì— columnConfigsë¥¼ ì •ì˜í•©ë‹ˆë‹¤!
        const columnConfigs = {
            "team1": [ 
                { field: "id", headerName: "ID", width: 70 },
                { field: "name", headerName: "ì˜ì—…ë‹´ë‹¹ì", flex: 1 },
                { field: "status", headerName: "ê³„ì•½ìƒíƒœ" },
                { field: "date", headerName: "ë§ˆê°ì¼" }
            ],
            "team3": [ 
                { field: "id", headerName: "ID", width: 70 },
                { field: "name", headerName: "í”„ë¡œì íŠ¸ëª…", flex: 1 },
                { field: "status", headerName: "ì§„í–‰ë‹¨ê³„" },
                { field: "date", headerName: "ë°°í¬ì˜ˆì •ì¼" }
            ],
            "default": [ 
                { field: "id", headerName: "ID", width: 70 },
                { field: "name", headerName: "ì´ë¦„", flex: 1 },
                { field: "status", headerName: "ìƒíƒœ" },
                { field: "date", headerName: "ë‚ ì§œ" }
            ]
        };

        // 1. íŠ¸ë¦¬ ë°ì´í„° ë¡œë“œ ë° ë Œë”ë§
        fetch('/api/tree')
            .then(res => res.json())
            .then(data => {
                const container = document.getElementById('tree-container');
                data.forEach(parent => {
                    const pDiv = document.createElement('div');
                    pDiv.className = 'tree-node';
                    pDiv.innerHTML = `ğŸ“ <b>${parent.text}</b>`;
                    container.appendChild(pDiv);

                    parent.children.forEach(child => {
                        const cDiv = document.createElement('div');
                        cDiv.className = 'tree-node child-node';
                        cDiv.innerText = `ğŸ“„ ${child.text}`;
                        cDiv.onclick = () => loadGridData(child.id, child.text);
                        container.appendChild(cDiv);
                    });
                });
            });

        // 2. ê·¸ë¦¬ë“œ ì´ˆê¸°í™”
        const gridOptions = {
            columnDefs: [
                { field: "id", headerName: "ID", width: 70 },
                { field: "name", headerName: "ì´ë¦„", flex: 1 },
                { field: "status", headerName: "ìƒíƒœ" },
                { field: "date", headerName: "ë‚ ì§œ" }
            ],
            rowData: []
        };

        document.addEventListener('DOMContentLoaded', () => {
            const gridDiv = document.querySelector('#myGrid');
            gridApi = agGrid.createGrid(gridDiv, gridOptions);
        });

        // 3. íŠ¸ë¦¬ í´ë¦­ ì‹œ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜
        function loadGridData(itemId, itemName) {
            document.getElementById('grid-title').innerText = `${itemName} ìƒì„¸ ì •ë³´`;

            // 1. í•´ë‹¹ íŒ€ì˜ ì»¬ëŸ¼ ì„¤ì •ì„ ê°€ì ¸ì˜´ (ì—†ìœ¼ë©´ default ì‚¬ìš©)
            const newColumns = columnConfigs[itemId] || columnConfigs["default"];

            // 2. ê·¸ë¦¬ë“œì˜ ì»¬ëŸ¼ ì •ì˜ë¥¼ ì¦‰ì‹œ ë³€ê²½
            gridApi.setGridOption('columnDefs', newColumns);

            // 3. ë°ì´í„° ë¡œë“œ
            if (itemId == "team3" || itemId == "team4" ) {
                fetch(`/api/data/${itemId}`)
                    .then(res => res.json())
                    .then(data => {
                        gridApi.setGridOption('rowData', data);
                    });
            } else {
                fetch(`/api/query/${itemId}`)
                    .then(res => res.json())
                    .then(data => {
                        gridApi.setGridOption('rowData', data);
                    });
            }
        }
    </script>
</body>
</html>